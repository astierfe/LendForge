$ node test_subgraph_queries.js
═══════════════════════════════════════════════════════
LendForge v3.0 Subgraph Validation Test
═══════════════════════════════════════════════════════
Subgraph URL: https://api.studio.thegraph.com/query/122308/lendforge-v-4/version/latest
Test User: 0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01

✅ 1. All Users With Collaterals - SUCCESS
{
  "users": [
    {
      "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01",
      "totalCollateralUSD": "20100000000",
      "totalBorrowed": "0",
      "activePositions": 0,
      "lifetimeDeposits": "100102000000101000000",
      "lifetimeBorrows": "100000000",
      "lifetimeRepayments": "100000000",
      "liquidationCount": 0,
      "createdAt": "1761386340",
      "updatedAt": "1761562284",
      "collaterals": [
        {
          "asset": {
            "id": "0x2fa332e8337642891885453fd40a7a7bb010b71a",
            "symbol": "DAI",
            "decimals": 18,
            "ltv": 90,
            "liquidationThreshold": 95
          },
          "amount": "100000000000000000000",
          "valueUSD": "20000000000",
          "updatedAt": "1761387000"
        },
        {
          "asset": {
            "id": "0xc47095ad18c67fba7e46d56bdbb014901f3e327b",
            "symbol": "USDC",
            "decimals": 18,
            "ltv": 90,
            "liquidationThreshold": 95
          },
          "amount": "101000000",
          "valueUSD": "20100000000",
          "updatedAt": "1761562284"
        },
        {
          "asset": {
            "id": "0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",
            "symbol": "ETH",
            "decimals": 18,
            "ltv": 66,
            "liquidationThreshold": 83
          },
          "amount": "0",
          "valueUSD": "20000000000",
          "updatedAt": "1761558996"
        }
      ],
      "positions": [
        {
          "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01",
          "totalCollateralUSD": "0",
          "borrowed": "0",
          "healthFactor": "166",
          "status": "REPAID",
          "createdAt": "1761386340",
          "updatedAt": "1761561288"
        }
      ]
    }
  ]
}

✅ 2. Global Metrics - SUCCESS
{
  "globalMetrics": [
    {
      "id": "global",
      "totalUsers": 1,
      "totalPositions": 0,
      "activePositions": 0,
      "totalVolumeDeposited": "100102000000101000000",
      "totalVolumeBorrowed": "100000000",
      "totalVolumeRepaid": "100000000",
      "totalLiquidations": 0,
      "currentTVL": "0",
      "currentBorrowed": "0",
      "allTimeHighTVL": "0",
      "allTimeHighBorrowed": "100000000",
      "totalETHDeposited": "0",
      "totalUSDCDeposited": "0",
      "totalDAIDeposited": "0",
      "updatedAt": "1761562284"
    }
  ]
}

✅ 3. Collateral Assets - SUCCESS
{
  "collateralAssets": [
    {
      "id": "0x2fa332e8337642891885453fd40a7a7bb010b71a",
      "symbol": "DAI",
      "decimals": 18,
      "ltv": 90,
      "liquidationThreshold": 95,
      "enabled": true,
      "totalDeposited": "100000000000000000000"
    },
    {
      "id": "0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",
      "symbol": "ETH",
      "decimals": 18,
      "ltv": 66,
      "liquidationThreshold": 83,
      "enabled": true,
      "totalDeposited": "0"
    },
    {
      "id": "0xc47095ad18c67fba7e46d56bdbb014901f3e327b",
      "symbol": "USDC",
      "decimals": 18,
      "ltv": 90,
      "liquidationThreshold": 95,
      "enabled": true,
      "totalDeposited": "101000000"
    }
  ]
}

✅ 4. Recent Transactions - SUCCESS
{
  "transactions": [
    {
      "id": "0xadf152afb3b49124341e6135109b76f26a29753c6d9340e196a233a203016daf-DEPOSIT_ERC20-9501023",
      "user": {
        "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01"
      },
      "position": {
        "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01"
      },
      "type": "DEPOSIT_ERC20",
      "asset": "0xc47095ad18c67fba7e46d56bdbb014901f3e327b",
      "amount": "1000000",
      "timestamp": "1761562284",
      "blockNumber": "9501023",
      "txHash": "0xadf152afb3b49124341e6135109b76f26a29753c6d9340e196a233a203016daf"
    },
    {
      "id": "0x78f348ea0142b5ef25570e6596fabdf4211bd320db7e43383204dc0374856aea-REPAY-9500940",       
      "user": {
        "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01"
      },
      "position": {
        "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01"
      },
      "type": "REPAY",
      "asset": null,
      "amount": "100000000",
      "timestamp": "1761561288",
      "blockNumber": "9500940",
      "txHash": "0x78f348ea0142b5ef25570e6596fabdf4211bd320db7e43383204dc0374856aea"
    },
    {
      "id": "0x7679460a621d25d75ebe1bb6ab1562c084230226d2385c039e2e2329e0fe6ae7-BORROW-9500928",      
      "user": {
        "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01"
      },
      "position": {
        "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01"
      },
      "type": "BORROW",
      "asset": null,
      "amount": "100000000",
      "timestamp": "1761561144",
      "blockNumber": "9500928",
      "txHash": "0x7679460a621d25d75ebe1bb6ab1562c084230226d2385c039e2e2329e0fe6ae7"
    },
    {
      "id": "0xd1db407e297c6ebe36c39e6ed56ae57f5256363e9e10c97bee0580d9f0e60fee-WITHDRAW_ETH-9500750",      "user": {
        "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01"
      },
      "position": {
        "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01"
      },
      "type": "WITHDRAW_ETH",
      "asset": "0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",
      "amount": "102000000000000000",
      "timestamp": "1761558996",
      "blockNumber": "9500750",
      "txHash": "0xd1db407e297c6ebe36c39e6ed56ae57f5256363e9e10c97bee0580d9f0e60fee"
    },
    {
      "id": "0xbf807d2813e1bac3c8c765a5c5c831c4a28686426123b89157a1ec952f1bcb67-DEPOSIT_ETH-9486715", 
      "user": {
        "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01"
      },
      "position": {
        "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01"
      },
      "type": "DEPOSIT_ETH",
      "asset": "0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",
      "amount": "100000000000000000",
      "timestamp": "1761390168",
      "blockNumber": "9486715",
      "txHash": "0xbf807d2813e1bac3c8c765a5c5c831c4a28686426123b89157a1ec952f1bcb67"
    },
    {
      "id": "0x7baf5d6a6602074738b7b9af9fe63f084745d47c13623a2190f3786288b8378a-DEPOSIT_ETH-9486708", 
      "user": {
        "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01"
      },
      "position": {
        "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01"
      },
      "type": "DEPOSIT_ETH",
      "asset": "0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",
      "amount": "1000000000000000",
      "timestamp": "1761390072",
      "blockNumber": "9486708",
      "txHash": "0x7baf5d6a6602074738b7b9af9fe63f084745d47c13623a2190f3786288b8378a"
    },
    {
      "id": "0xf1100284ce4385e267501d74600c7ecb653110d6df534d7b13cf5c9803302d37-DEPOSIT_ETH-9486698", 
      "user": {
        "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01"
      },
      "position": {
        "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01"
      },
      "type": "DEPOSIT_ETH",
      "asset": "0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",
      "amount": "1000000000000000",
      "timestamp": "1761389952",
      "blockNumber": "9486698",
      "txHash": "0xf1100284ce4385e267501d74600c7ecb653110d6df534d7b13cf5c9803302d37"
    },
    {
      "id": "0x6a202e2ef7cdd71348902ab5c74f0647b9bf0bfe68ef63c5d9814ec585b2f4a1-DEPOSIT_ERC20-9486461",
      "user": {
        "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01"
      },
      "position": {
        "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01"
      },
      "type": "DEPOSIT_ERC20",
      "asset": "0x2fa332e8337642891885453fd40a7a7bb010b71a",
      "amount": "100000000000000000000",
      "timestamp": "1761387000",
      "blockNumber": "9486461",
      "txHash": "0x6a202e2ef7cdd71348902ab5c74f0647b9bf0bfe68ef63c5d9814ec585b2f4a1"
    },
    {
      "id": "0xcef413ad461e16428558f52650fa31524994ed83af312b6aa073d1a62c3ecc1c-DEPOSIT_ERC20-9486409",
      "user": {
        "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01"
      },
      "position": {
        "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01"
      },
      "type": "DEPOSIT_ERC20",
      "asset": "0xc47095ad18c67fba7e46d56bdbb014901f3e327b",
      "amount": "100000000",
      "timestamp": "1761386340",
      "blockNumber": "9486409",
      "txHash": "0xcef413ad461e16428558f52650fa31524994ed83af312b6aa073d1a62c3ecc1c"
    }
  ]
}

✅ 5. Liquidations - SUCCESS
{
  "liquidations": []
}

✅ 6. Price Deviations - SUCCESS
{
  "priceDeviations": []
}

✅ 7. User Specific Collaterals - SUCCESS
{
  "user": {
    "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01",
    "totalCollateralUSD": "20100000000",
    "totalBorrowed": "0",
    "collaterals": [
      {
        "asset": {
          "id": "0x2fa332e8337642891885453fd40a7a7bb010b71a",
          "symbol": "DAI",
          "decimals": 18
        },
        "amount": "100000000000000000000",
        "valueUSD": "20000000000",
        "updatedAt": "1761387000"
      },
      {
        "asset": {
          "id": "0xc47095ad18c67fba7e46d56bdbb014901f3e327b",
          "symbol": "USDC",
          "decimals": 18
        },
        "amount": "101000000",
        "valueUSD": "20100000000",
        "updatedAt": "1761562284"
      },
      {
        "asset": {
          "id": "0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",
          "symbol": "ETH",
          "decimals": 18
        },
        "amount": "0",
        "valueUSD": "20000000000",
        "updatedAt": "1761558996"
      }
    ],
    "positions": [
      {
        "id": "0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01",
        "totalCollateralUSD": "0",
        "borrowed": "0",
        "healthFactor": "166",
        "status": "REPAID"
      }
    ]
  }
}

✅ 8. Transactions By Asset - SUCCESS
{
  "transactions": []
}

✅ 9. Active Positions - SUCCESS
{
  "positions": []
}

✅ 10. Daily Metrics - SUCCESS
{
  "dailyMetrics": []
}


═══════════════════════════════════════════════════════
ANALYSIS OF RESULTS
═══════════════════════════════════════════════════════

✅ Successful queries: 10/10

USER DATA VALIDATION:
- User: 0xf350b91b403ced3c6e68d34c13ebdaae3bbd4e01
- Total Collateral USD: 20100000000
- Total Borrowed: 0
- Number of collaterals: 3

COLLATERAL BREAKDOWN:
  - DAI: 100.0000 (200.00 USD)
  - USDC: 0.0000 (201.00 USD)
  - ETH: 0.0000 (200.00 USD)

  TOTAL valueUSD from collaterals: $601.00
  REPORTED totalCollateralUSD: $201.00
  ⚠️  MISMATCH: Difference of $400.00


GLOBAL METRICS VALIDATION:
- Total Users: 1
- Total Positions: 0
- Active Positions: 0
- Current TVL: 0 USD
- Current Borrowed: 0 USD
- ETH Deposited: 0 ETH
- USDC Deposited: 0 USDC
- DAI Deposited: 0 DAI


COLLATERAL ASSETS CONFIGURATION:
- DAI (0x2fa332e8337642891885453fd40a7a7bb010b71a)
  Decimals: 18
  LTV: 90%
  Liquidation Threshold: 95%
  Enabled: true
  Total Deposited: 100000000000000000000
- ETH (0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee)
  Decimals: 18
  LTV: 66%
  Liquidation Threshold: 83%
  Enabled: true
  Total Deposited: 0
- USDC (0xc47095ad18c67fba7e46d56bdbb014901f3e327b)
  Decimals: 18
  LTV: 90%
  Liquidation Threshold: 95%
  Enabled: true
  Total Deposited: 101000000


RECENT TRANSACTIONS: 9 found
- DEPOSIT_ERC20 | 1000000 | Block 9501023
- REPAY | 100000000 | Block 9500940
- BORROW | 100000000 | Block 9500928
- WITHDRAW_ETH | 102000000000000000 | Block 9500750
- DEPOSIT_ETH | 100000000000000000 | Block 9486715


═══════════════════════════════════════════════════════
TEST COMPLETE
═══════════════════════════════════════════════════════